@model BsmWebApp.ViewModels.Changes.NiyudBudgetViewModel

    <div>
        <div class="row">
           
            <div class="col-md-2">
                <label class="TextBold"> מתקן נותן:</label>
            </div>
            <div class="col-md-4">
                @Html.DropDownListFor(m => Model.YechidaOut.KodYechida, Model.YechidotOut, new { @id = "KodMitkanOut", @onchange = "EnableFields();", @class = "ddl", style = "width: 250px;height: 29px;" })
            </div>
             <div class="col-md-2">
                <label class="TextBold"> מתקן מקבל:</label>
            </div>
            <div class="col-md-4">
                @Html.DropDownListFor(m => Model.YechidaIn.KodYechida, Model.YechidotIn, new { @id = "KodMitkanIn", @onchange = "EnableFields();", @class = "ddl", style = "width:250px;height: 29px;" })
            </div>
        </div>
        <br />
        <br />
        <div class="row">
            <div class="col-md-2">
                <label class="TextBold"> כמות:</label>
            </div>
            <div class="col-md-3">
                <input id="inputKamut"  onfocus="this.select();" disabled="disabled"   class="styleTBSearch GeneralText TextBoxRO AmountInput" />
            </div>
            <div class="col-md-1">
                <label class="TextBold"> הנמקה:</label>
            </div>
            <div class="col-md-6">
                <textarea id="inputReson" placeholder='רשום הנמקה לניוד תקציב...' disabled="disabled"  style="width:350px;height:135px" maxlength="200" spellcheck="false" autofocus></textarea>
            </div>

        </div>
        <br />
        <br />

    </div>

<div style="float:left">
    <button id="btnAuto" value="עדכן תקציב" style="width:100px" class="PurpleButton" onclick="ChangeBudgetAjax();">עדכן תקציב</button>
</div>

<script>
    $(document).ready(function () {
        $("#inputKamut").mask('09999.9', { placeholder: "" });

       $('#KodMitkanOut option').each(function (i, item) {
            if (item.text.indexOf(')') > -1) {
                var split = item.text.split(')')[0].split(' ');
                var num = split[split.length - 1];
                if (+num == 0)
                    item.disabled = true;
            }
            else {
                if (item.value !=0 )
                    item.disabled = true;
            }
        });
    });

    function EnableFields() {
       // debugger;
        var selectMitkanIn = $('#KodMitkanIn')[0].selectedIndex;
        var selectMitkanOut = $('#KodMitkanOut')[0].selectedIndex;

        if (selectMitkanIn != 0 && selectMitkanOut != 0)
        {
            $("#inputKamut").prop('disabled', false);
            $("#inputReson").prop('disabled',false);
        }
        else {
            $("#inputKamut").prop('disabled', true);
            $("#inputReson").prop('disabled', true);
        }

    }

    function CheckAmount() {
        var kamut = $("#inputKamut").val();
        if (kamut != "") {
         //   var selectTakziv = $('#KodTakziv')[0].selectedIndex;
            var takziv = $("#KodMitkanOut option:selected").text();
            var split = takziv.split(')')[0].split(' ');
            var num = split[split.length - 1];

            if (+kamut > +num) {
                //  $("#btnAuto").prop('disabled', true);
                AlertMessage("לא ניתן לעדכן מעבר ליתרה", 150, 300);
                return false;
            }
            else
                return true;
                //$("#btnAuto").prop('disabled', false);
        }
    }

    function CheckMitkanimShonim() {
        var selectMitkanIn = $('#KodMitkanIn')[0].selectedIndex;
        var selectMitkanOut = $('#KodMitkanOut')[0].selectedIndex;
        if (selectMitkanIn == selectMitkanOut) {
            AlertMessage("יש לבחור מתקנים שונים", 150, 300);
            return false;
        }
        return true;
    }
    function ChangeBudgetAjax() {

        if (InsertAllFields()) {
            if (CheckMitkanimShonim()) {
                if (CheckAmount()) {
                    var selectMitkanIn = $('#KodMitkanIn')[0].value;
                    var selectMitkanOut = $('#KodMitkanOut')[0].value;
                    var inputReson = $("#inputReson").val();
                    var kamutVal = $("#inputKamut").val();

                    var data = { Mitkan: selectMitkanIn, MitkanOut: selectMitkanOut, Kamut: kamutVal, Comment: inputReson };
                    $.post("/Changes/SaveNiyudBudget", data, function (res) {
                        AlertMessage("הנתונים עודכנו בהצלחה", 150, 300);
                        RefreshGridChanges();
                        $("#dialog-change").dialog("close");
                    });
                }
            }
        }
        else {
            AlertMessage("חובה לעדכן את כל השדות", 150, 300);
            return false;
        }
    }

    function InsertAllFields() {
        var selectMitkanIn = $('#KodMitkanIn')[0].selectedIndex;
        var selectMitkanOut = $('#KodMitkanOut')[0].selectedIndex;
        var inputReson = $("#inputReson").val();
        var kamut = $("#inputKamut").val();
        if (selectMitkanIn == 0 || selectMitkanOut == 0 || inputReson == "" || kamut == "" || +kamut == 0) {
            return false;
        }
        else {
            return true;
            // AddBudgetNew(@Html.Raw(Json.Encode(Model)) );
        }


    }
</script>